# TIL | 2025.03.29

## ğŸ“Œ TIL ìš”ì•½

### ì•Œê³ ë¦¬ì¦˜

-   ì •ë ¬ê³¼ ê·¸ë¦¬ë”” ê²°ì • ì•Œê³ ë¦¬ì¦˜ 10 ~ 12

### ì†Œì¼“ ì ìš©

-   singletonìœ¼ë¡œ ë¶„ë¦¬ Stompjs ê°ì²´

    -   ì²˜ìŒì—ëŠ” ì†Œì¼“ ìƒì„±í›„ ì—°ê²°ë§Œ í–ˆì—ˆìŒ

-   ëª¨ë¥´ëŠ”ê±°

    -   activateëŠ” ì‹¤ì œ ì—°ê²° ì‹œë„ë¥¼ ì‹œì‘í•˜ëŠ” ë©”ì†Œë“œ
        -   ì—°ê²° ì™„ë£Œ/ì‹¤íŒ¨ ì‹œì ì„ ì•Œë ¤ë©´ onConnect/onStompError í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ì„œ ì—°ê²° ì‹œì‘ì´ ì•„ë‹Œ ì—°ê²°ì´ ì™„ë£Œë˜ê±°ë‚˜ ì‹¤íŒ¨í•œ ì§€ì ì— ë‹¤ìŒ ë™ì‘ì„ ìˆ˜í–‰í•˜ê²Œ í•¨

-   ì±„ìŠ¹ì´ êµ¬í˜„ ë°©ì‹
    -   ì†Œì¼“ instance ë° rtc , yjs ì†Œì¼“ class ë¥¼ ë”°ë¡œ ì‘ì„±
    -   ì†Œì¼“ ë§¤ë‹ˆì €ì—ì„œ í•œë²ˆì— ê´€ë¦¬

---

# ë„ì„œ : ì¢‹ì€ì½”ë“œ ë‚˜ìœì½”ë“œ

## 1ì¥

-   ì½”ë“œ í’ˆì§ˆì˜ ì—¬ì„¯ ê°€ì§€ í•µì‹¬ ìš”ì†Œ
    1. ì½”ë“œëŠ” ì½ê¸° ì‰¬ì›Œì•¼ í•œë‹¤.
    2. ì½”ë“œëŠ” ì˜ˆì¸¡ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
    3. ì½”ë“œë¥¼ ì˜¤ìš©í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ë¼.
    4. ì½”ë“œë¥¼ ëª¨ë“ˆí™”í•˜ë¼
    5. ì½”ë“œë¥¼ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê³  ì¼ë°˜í™”í•  ìˆ˜ ìˆê²Œ ì‘ì„±í•˜ë¼.
    6. í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì œëŒ€ë¡œ í…ŒìŠ¤íŠ¸í•˜ë¼

### 1ì¥ ìš”ì•½

> ì¢‹ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“¤ë ¤ë©´ ê³ í’ˆì§ˆ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.
> ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ê°€ ë˜ê¸° ì „ì—ëŠ” ì½”ë“œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì—¬ëŸ¬ ë‹¨ê³„ì˜ ê²€ì‚¬ì™€ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼ì• í– í•œë‹¤.(ë•Œë¡œëŠ” ìˆ˜ë™ ë•Œë¡œëŠ” ìë™í™”ë¥¼ í†µí•´ì„œ)
> ë²„ê·¸ë‚˜ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ ì‚¬ìš©ìì—ê²Œ ì œê³µë˜ê±°ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ì— ì¤‘ìš”í•œ ì‹œìŠ¤í…œì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ì´ëŸ¬í•œ ê²€ì‚¬ë¥¼ í†µí•´ ë§‰ì„ ìˆ˜ ìˆë‹¤.
> í…ŒìŠ¤íŠ¸ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ëª¨ë“  ë‹¨ê³„ì—ì„œ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì¢‹ì•„. ì½”ë“œë¥¼ ë‹¤ ì‘ì„±í•˜ê³  ë‚œ í›„ì— ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.
> ê³ í’ˆì§ˆ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì²˜ìŒì—ëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ì§€ë§Œ, ì¤‘ì¥ê¸°ì ìœ¼ë¡œëŠ” ê°œë°œ ì‹œê°„ì´ ë‹¨ì¶•ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

## ì¶”ìƒí™” ê³„ì¸µ

-   ì½”ë“œë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì€ ì½”ë“œ í’ˆì§ˆì˜ ê¸°ë³¸ì ì¸ ì¸¡ë©´ ì¤‘ í•˜ë‚˜ì´ë©°, ì½”ë“œë¥¼ ì˜ êµ¬ì„±í•œë‹¤ëŠ” ê²ƒì€ ê°„ê²°í•œ ì¶”ìƒí™” ê³„ì¸µì‹ ë§Œë“œëŠ” ê²ƒìœ¼ë¡œ ê·€ê²°ë  ë•Œê°€ ë§ë‹¤.

### 2.2 ì™œ ì¶”ìƒí™” ê³„ì¸µì„ ë§Œë“œëŠ”ê°€

-   ì½”ë“œ ì‘ì„±ì€ ë³µì¡í•œ ë¬¸ì œë¥¼ ê³„ì†í•´ì„œ ë” ì‘ì€ ë¬¸ì œë¡œ ì„¸ë¶„í™”í•˜ëŠ” ì‘ì—…ì´ë‹¤.
    -   ë¬¸ì œê°€ ì—„ì²­ë‚˜ê²Œ ë³µì¡í• ì§€ë¼ë„ í•˜ìœ„ ë¬¸ì œë“¤ì„ ì‹ë³„í•˜ê³  ì˜¬ë°”ë¥¸ ì¶”ìƒí™” ê³„ì¸µì„ ë§Œë“¦ìœ¼ë¡œì¨ ë³µì¡í•œ ë¬¸ì œë¥¼ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.
-   2.2.1 ì¶”ìƒí™” ê³„ì¸µ ë° ì½”ë“œ í’ˆì§ˆì˜ í•µì‹¬ ìš”ì†Œ
    -   ê¹¨ë—í•˜ê³  ëšœë ·í•œ ì¶”ìƒí™” ê³„ì¸µì„ êµ¬ì¶•í•˜ë©´ ì½”ë“œ í’ˆì§ˆì˜ ë„¤ ê°€ì§€ í•µì‹¬ ìš”ì†Œë¥¼ ë§Œì¡± ê°€ëŠ¥
        -   ê°€ë…ì„±, ëª¨ë“ˆí™”, ì¬ì‚¬ìš©ì„± ë° ì¼ë°˜í™”ì„œ, í…ŒìŠ¤íŠ¸ ìš©ì´ì„±

### í‚¤ì›Œë“œ

-   ì‘ì§‘ë ¥
-   ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
-   ì¶”ìƒí™” ê³„ì¸µ
-   íŒ©í† ë¦¬ í•¨ìˆ˜
-   ì¸í„°í˜ì´ìŠ¤

### 1ì°¨ ì†Œì¼“ ìˆ˜ì •ë³¸

```ts
import { create } from 'zustand';
import { StompSocket, stompSocket } from '@/lib/socket';
import * as StompJs from '@stomp/stompjs';

interface SocketStore {
    socket: StompJs.Client | null;
    isStompSocketIsReady: boolean;
    connect: () => void;
    discconect: () => void;
    subscribe: (topic: string, callback: (message: any) => void) => void;
    publish: (topic: string, message?: string | undefined) => void;
}

export const useSocketStore = create<SocketStore>()((set, get) => ({
    socket: null,
    isStompSocketIsReady: false,
    connect: async () => {
        try {
            const stompClient = await StompSocket.getInstance().initializeSocket();
            console.log('storeì—ì„œ stompclient', stompClient);
            set({ socket: stompClient, isStompSocketIsReady: true });
        } catch (e) {
            console.log(e);
        }
    },
    discconect: () => {
        const { socket, isStompSocketIsReady } = get();
        if (!socket || !isStompSocketIsReady!) return;
        socket.deactivate();
    },
    subscribe: (topic, callback) => {
        const { socket, isStompSocketIsReady } = get();
        if (!socket || !isStompSocketIsReady) return;
        socket.subscribe(topic, callback);
    },
    publish: (topic: string, message: string | undefined) => {
        const { socket, isStompSocketIsReady } = get();
        if (!socket || !isStompSocketIsReady) return;
        socket.publish({
            destination: topic,
            body: message ? message : undefined,
        });
    },
}));
```

```ts
import SockJS from 'sockjs-client';
import * as StompJs from '@stomp/stompjs';

const SERVER_URL = process.env.NEXT_PUBLIC_SERVER_DEV_URL;

export class StompSocket {
    private static instance: StompSocket;

    private constructor() {}

    public static getInstance() {
        if (!StompSocket.instance) {
            StompSocket.instance = new StompSocket();
        }
        return StompSocket.instance;
    }

    public initializeSocket() {
        return new Promise<StompJs.Client>((resolve, reject) => {
            const socket = new StompJs.Client({
                webSocketFactory: () => {
                    return new SockJS(`${SERVER_URL}/api/ws`);
                },
            });
            socket.onConnect = () => {
                console.log('socket ì—°ê²° ì„±ê³µ');
                resolve(socket);
            };
            socket.onStompError = () => {
                console.log('socket ì—°ê²° ì‹¤íŒ¨');
            };
            socket.activate();
        });
    }
}

export const stompSocket = StompSocket.getInstance();
```

### 1ì°¨ êµ¬í˜„ í›„ íšŒê³  ë° ìˆ˜ì •í•  ë¶€ë¶„ ì¡°ì‚¬

-

###

```ts
import SockJS from 'sockjs-client';
import * as StompJs from '@stomp/stompjs';

const SERVER_URL = process.env.NEXT_PUBLIC_SERVER_DEV_URL;

export class StompSocket {
    private static instance: StompSocket;
    private client: StompJs.Client | null = null;

    private constructor() {}

    public static getInstance() {
        if (!StompSocket.instance) {
            StompSocket.instance = new StompSocket();
        }
        return StompSocket.instance;
    }

    public connect() {
        return new Promise<boolean>((resolve, reject) => {
            this.client = new StompJs.Client({
                webSocketFactory: () => {
                    return new SockJS(`${SERVER_URL}/api/ws`);
                },
            });
            this.client.onConnect = () => {
                console.log('socket ì—°ê²° ì„±ê³µ');
                resolve(true);
            };
            this.client.onStompError = () => {
                console.log('socket ì—°ê²° ì‹¤íŒ¨');
                reject(false);
            };
            this.client.activate();
        });
    }

    public deactivate() {
        if (!this.checkIsConnected()) return;

        this.client?.deactivate();
    }

    public subscribe(topic: string, callback: (message: StompJs.IFrame) => void) {
        if (!this.checkIsConnected()) return;

        this.client?.subscribe(topic, callback);
    }

    public publish(topic: string, message?: string) {
        if (!this.checkIsConnected()) return;
        this.client?.publish({
            destination: topic,
            body: message ? message : undefined,
        });
    }

    private checkIsConnected() {
        if (!this.client || !this.client?.connected) {
            console.log('ì†Œì»· ì—°ê²°ì´ ì•ˆë¬ìŠµë‹ˆë‹¤.');
            return false;
        }
        return true;
    }
}

export const stompSocket = StompSocket.getInstance();
```

## throw new Error(error) vs throw error

-   catch ì—ì„œ ë‹¤ì‹œ throw í•  ë•Œ
    -   try ì—ì„œ ë˜ì§€ëŠ” ê²½ìš°
        -   íŠ¹ì • ë¡œì§ì— ë”°ë¼ ì˜ë„í•œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš° ì—ëŸ¬ë¥¼ ì˜ë„ì ìœ¼ë¡œ ë°œìƒì‹œí‚¤ê¸° ìœ„í•´ì„œ
    -   catchì—ì„œ ë˜ì§€ëŠ” ê²½ìš°
        -   catch ë¸”ë¡ì—ì„œ ìš°ë¦¬ê°€ ì˜ˆìƒí–ˆë˜ íŠ¹ì • íƒ€ì…ì˜ ì—ëŸ¬ë§Œ ì²˜ë¦¬í•˜ê³  ë‹¤ë¥¸ íƒ€ì…ì˜ ì—ëŸ¬ëŠ” ìƒìœ„ í˜¸ì¶œìì—ê²Œ ì „íŒŒí•˜ê³  ì‹¶ì„ ë•Œ (= ì—ëŸ¬ ë‹¤ì‹œ ë˜ì§€ê¸° )
        -   ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ê·¸ ì—ëŸ¬ì˜ ë©”ì‹œì§€ë‚˜ íƒ€ì…ì´ ë¶€ì ì ˆí•˜ê±°ë‚˜ ì¶©ë¶„í•œ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨ë˜ë©´, ìƒˆë¡œìš´ ì—ëŸ¬ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ê·¸ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  throw í•˜ëŠ” ê²½ìš°
        -   ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ íŠ¹ì • ë¡œì§ì„ ìˆ˜í–‰í•œ í›„ì—ë„ ê°™ì€ ì—ëŸ¬ë¥¼ ê³„ì† ì „íŒŒí•˜ê³  ì‹¶ì„ ë•Œ
-   catch ì•ˆì—ì„œ ì—ëŸ¬ë¥¼ ë˜ì§ˆ ë•Œ 2ê°€ì§€ì˜ ê²½ìš°ì— ì°¨ì´ì 

```ts
catch (error) {
    throw new Error(error);
}

catch (error) {
    throw error;
}
```

### throw new Error(error);

-   ì´ ê²½ìš°ì—ëŠ” ìƒˆë¡œìš´ Error ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë˜ì§‘ë‹ˆë‹¤.
-   errorê°€ ë¬¸ìì—´ì´ê±°ë‚˜ toString ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” ê°ì²´ë¼ë©´, ê·¸ ê°’ì„ ë©”ì‹œì§€ë¡œ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ Error ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    > ê·¸ë ‡ì§€ë§Œ ì´ ë°©ë²•ì€ Error ê°ì²´ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ë¯€ë¡œ ì›ë˜ì˜ error ë¡œ ë„˜ì–´ì˜¨ ì—ëŸ¬ ê°ì²´ì˜ ì¼ë¶€ ì •ë³´ë¥¼ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤

### throw error;

-   ì´ ê²½ìš°ì—ëŠ” error ê°ì²´ ìì²´ë¥¼ ë˜ì§‘ë‹ˆë‹¤.
-   ì´ê²ƒì€ catch ë¸”ë¡ì—ì„œ ë°›ì€ ì›ë˜ì˜ ì—ëŸ¬ ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ë˜ì§€ëŠ” ê²ƒì´ë¯€ë¡œ, ì›ë˜ì˜ ì—ëŸ¬ ê°ì²´ì— ìˆë˜ ëª¨ë“  ì •ë³´ì™€ ì†ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤.
    > ê·¸ë ‡ì§€ë§Œ new Error(error) í˜•íƒœë¡œ ì—ëŸ¬ë¥¼ ë˜í•‘í•˜ê³  ë˜ì§€ë©´, ì›ë˜ì˜ CustomError ê°ì²´ì˜ code ì†ì„±ê³¼ ê°™ì€ ì¶”ê°€ ì •ë³´ëŠ” ì‚¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤

### ì°¸ì¡°

-   https://velog.io/@minh0518/throw-new-Errorerror-vs-throw-error
